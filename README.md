# SpringBoot-JPA-Project-ì‚°ì±…ê°ˆê°œ
ìŠ¤í”„ë§ë¶€íŠ¸ JPA í”„ë¡œì íŠ¸
<br>


## ğŸ–¥ï¸ í”„ë¡œì íŠ¸ ì†Œê°œ
ê°•ì•„ì§€ ì‚°ì±… ì†Œì…œë©”ì´íŠ¸, ì‡¼í•‘ í”Œë«í¼
<br>


## ğŸ•°ï¸ ê°œë°œ ê¸°ê°„
* 2023.11 - 2024.01

### ğŸ§‘â€ğŸ¤â€ğŸ§‘ ë§´ë²„êµ¬ì„±
 - íŒ€ì¥: ë…¸ì˜ì§„ : ì‡¼í•‘í˜ì´ì§€, ì¥ë°”êµ¬ë‹ˆ, ì£¼ë¬¸ì„œ ë° ê²°ì œ í˜ì´ì§€, ììœ ê²Œì‹œíŒ, ê³µì§€ì‚¬í•­ ê²Œì‹œíŒ
 - íŒ€ì›1: ë³µì˜í—Œ : ë©”ì¸í˜ì´ì§€(ì‚°ì±…ê¸€ ëª©ë¡, ì£¼ê°„ì¸ê¸°ê¸€, ì‡¼í•‘ ë“±), ë¡œê·¸ì¸ ë° íšŒì›ê°€ì… ë“± ê³„ì •ê´€ë¦¬ í˜ì´ì§€, ì‚°ì±… ë©”ì´íŠ¸ ê²Œì‹œíŒ, ê´€ë¦¬ìí˜ì´ì§€
 - íŒ€ì›2: ì„í˜•ì¤€ : ë§ˆì´í˜ì´ì§€, QnAê²Œì‹œíŒ


### âš™ï¸ ê°œë°œ í™˜ê²½
- **IDE** : IntelliJ IDEA
- **Framework** : Springboot(3.x)
- **Database** : Oracle DB(11xe)
- **ORM** : JPA

### ğŸ“Œí¬íŠ¸í´ë¦¬ì˜¤ 

[ì‚°ì±…í• ê°œ_í¬íŠ¸í´ë¦¬ì˜¤.pdf](https://github.com/bokkaa/JPA-DW/files/14415033/_.pdf)

## ğŸ“Œ ë‚´ê°€ ë§¡ì€ ê¸°ëŠ¥
#### ë©”ì¸ í˜ì´ì§€ <a href="https://github.com/bokkaa/JPA-DW/wiki/%EB%A9%94%EC%9D%B8%ED%8E%98%EC%9D%B4%EC%A7%80" >ìƒì„¸ë³´ê¸° - WIKI ì´ë™</a>
- ì‚°ì±…ë©”ì´íŠ¸ ìµœì‹  ë¦¬ìŠ¤íŠ¸
- ì£¼ê°„ ì¸ê¸° QnA ê²Œì‹œê¸€/ ììœ ê²Œì‹œíŒ ê¸€
- ì¹´í…Œê³ ë¦¬ë³„ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸
- ìµœê·¼ ë³¸ ìƒí’ˆ

#### ë¡œê·¸ì¸ / íšŒì›ê°€ì… / ê³„ì •ì°¾ê¸° <a href="https://github.com/bokkaa/JPA-DW/wiki/%EA%B3%84%EC%A0%95-%EA%B4%80%EB%A0%A8" >ìƒì„¸ë³´ê¸° - WIKI ì´ë™</a>
- ë¡œê·¸ì¸
- íšŒì›ê°€ì…
- ê³„ì •ì°¾ê¸°

#### ì‚°ì±…ê²Œì‹œê¸€ í˜ì´ì§€ <a href="https://github.com/bokkaa/JPA-DW/wiki/%EC%82%B0%EC%B1%85%EB%A9%94%EC%9D%B4%ED%8A%B8-%EA%B2%8C%EC%8B%9C%ED%8C%90" >ìƒì„¸ë³´ê¸° - WIKI ì´ë™</a>
- ì‚°ì±…ê²Œì‹œê¸€ ëª©ë¡
- ì‚°ì±…ê²Œì‹œê¸€ ìƒì„¸
- ì‚°ì±…ê²Œì‹œê¸€ ë“±ë¡
- ì‚°ì±…ê²Œì‹œê¸€ ìˆ˜ì • ë° ì‚­ì œ
  
#### ê´€ë¦¬ì í˜ì´ì§€ <a href="https://github.com/dafssdf/Spring_Portfoilo/wiki/%EB%A7%88%EC%9D%B4-%ED%8E%98%EC%9D%B4%EC%A7%80" >ìƒì„¸ë³´ê¸° - WIKI ì´ë™</a>
- íšŒì›ê´€ë¦¬
- ìƒí’ˆê´€ë¦¬
- ì£¼ë¬¸ê´€ë¦¬
- ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬

<hr>

## ğŸ“Œì½”ë“œ ìˆ˜ì • 

<details><summary>1. ë¬´í•œ ì¦ì‹ DTO</summary>

<img width="467" alt="ì œëª© ì—†ìŒ" src="https://github.com/bokkaa/JPA-DW/assets/77730779/8ebbaafe-7333-4178-8bde-49104b332e1c">

- ì¡°íšŒ ì •ë³´ ë¡œì§ì„ ì£¼ë¡œ ë‹´ë‹¹í•˜ëŠ” ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì¡°íšŒìš© DTOë¥¼ ë§ˆêµ¬ì¡ì´ë¡œ ë§Œë“¤ë‹¤ë³´ë‹ˆ .java íŒŒì¼ ìì²´ê°€ ë„ˆë¬´ ë§ì•„ì¡Œë‹¤.
- ê·¸ë˜ì„œ ì´ê±¸ ì–´ë–»ê²Œ í•˜ë©´ ê°€ë…ì„±ë„ ì¢‹ê³  ìœ ì§€ë³´ìˆ˜ë¥¼ ì‰½ê²Œ í•  ìˆ˜ ìˆì„ê¹Œ í•´ì„œ ìƒê°í•´ë‚¸ ê²ƒì´ ë‚´ë¶€ í´ë˜ìŠ¤ì˜ í™œìš©ì´ì—ˆë‹¤.
- ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ í™œìš©í•˜ë‹ˆ ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ìƒí’ˆ ê´€ë ¨ DTOë¥¼ ì•½ 12ê°œì—ì„œ 4ê°œë¡œ ì¤„ì¼ ìˆ˜ ìˆì—ˆë‹¤.


<img width="352" alt="ì œëª© ì—†ìŒ1" src="https://github.com/bokkaa/JPA-DW/assets/77730779/43337bab-5c48-4db5-aab0-2af78ef683af">

<details><summary>Goods/AdminGoods.java </summary>
 
```java
package com.example.dw.domain.dto.admin.goods;

import com.querydsl.core.annotations.QueryProjection;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;
import java.util.List;

@Data
@NoArgsConstructor
public class AdminGoods extends AdminGoodsStan {


    private Long goodsMainImgId;
    private String goodsMainImgPath;
    private String goodsMainImgUuid;
    private String goodsMainImgName;

    private Long goodsDetailImgId;
    private String goodsDetailImgPath;
    private String goodsDetailImgUuid;
    private String goodsDetailImgName;


    @QueryProjection
    public AdminGoods(Long goodsId, String goodsName, String goodsCategory, Integer goodsQuantity, Integer goodsPrice, Integer goodsSaleCount, String goodsDetailContent, String goodsMate, String goodsCertify, LocalDateTime goodsRd, LocalDateTime goodsMd, Long goodsMainImgId, String goodsMainImgPath, String goodsMainImgUuid, String goodsMainImgName, Long goodsDetailImgId, String goodsDetailImgPath, String goodsDetailImgUuid, String goodsDetailImgName) {
        super(goodsId, goodsName, goodsCategory, goodsQuantity, goodsPrice, goodsSaleCount, goodsDetailContent, goodsMate, goodsCertify, goodsRd, goodsMd);
        this.goodsMainImgId = goodsMainImgId;
        this.goodsMainImgPath = goodsMainImgPath;
        this.goodsMainImgUuid = goodsMainImgUuid;
        this.goodsMainImgName = goodsMainImgName;
        this.goodsDetailImgId = goodsDetailImgId;
        this.goodsDetailImgPath = goodsDetailImgPath;
        this.goodsDetailImgUuid = goodsDetailImgUuid;
        this.goodsDetailImgName = goodsDetailImgName;
    }




    //ì œí’ˆ ë©”ì¸ ì‚¬ì§„
    @Data
    @NoArgsConstructor
    public static class AdminGoodsMainImg {

        private Long goodsMainImgId;
        private String goodsMainImgPath;
        private String goodsMainImgUuid;
        private String goodsMainImgName;


        public AdminGoodsMainImg(Long goodsMainImgId, String goodsMainImgPath, String goodsMainImgUuid, String goodsMainImgName) {
            this.goodsMainImgId = goodsMainImgId;
            this.goodsMainImgPath = goodsMainImgPath;
            this.goodsMainImgUuid = goodsMainImgUuid;
            this.goodsMainImgName = goodsMainImgName;
        }
    }

    //ì œí’ˆ ìƒì„¸ ì‚¬ì§„
    @Data
    public static class AdminGoodsDetailImg {
        private Long goodsDetailImgId;
        private String goodsDetailImgPath;
        private String goodsDetailImgUuid;
        private String goodsDetailImgName;


        public AdminGoodsDetailImg(Long goodsDetailImgId, String goodsDetailImgPath, String goodsDetailImgUuid, String goodsDetailImgName) {
            this.goodsDetailImgId = goodsDetailImgId;
            this.goodsDetailImgPath = goodsDetailImgPath;
            this.goodsDetailImgUuid = goodsDetailImgUuid;
            this.goodsDetailImgName = goodsDetailImgName;
        }
    }


    //ê´€ë¦¬ì í˜ì´ì§€ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸
    @Data
    public static class AdminGoodsList {

        private Long goodsId;
        private String goodsCategory;
        private String goodsName;
        private Integer goodsQuantity;
        private Integer goodsSaleCount;
        private Integer goodsPrice;

        private LocalDateTime goodsRd;
        private LocalDateTime goodsMd;

        @QueryProjection
        public AdminGoodsList(Long goodsId, String goodsCategory, String goodsName, Integer goodsQuantity, Integer goodsSaleCount, Integer goodsPrice, LocalDateTime goodsRd, LocalDateTime goodsMd) {
            this.goodsId = goodsId;
            this.goodsCategory = goodsCategory;
            this.goodsName = goodsName;
            this.goodsQuantity = goodsQuantity;
            this.goodsSaleCount = goodsSaleCount;
            this.goodsPrice = goodsPrice;
            this.goodsRd = goodsRd;
            this.goodsMd = goodsMd;
        }
    }


    //ê´€ë¦¬ì í˜ì´ì§€ ìƒí’ˆ ìƒì„¸ë³´ê¸°
    @Data
    public static class AdminGoodsDetail extends AdminGoodsStan {

        private Double ratingAvg;

        private String goodsMainImgPath;
        private String goodsMainImgUuid;
        private String goodsMainImgName;
        private List<AdminGoods.AdminGoodsDetailImg> adminGoodsDetailImg;

        public AdminGoodsDetail(Long goodsId, String goodsName, String goodsCategory, Integer goodsQuantity, Integer goodsPrice, Integer goodsSaleCount, String goodsDetailContent, String goodsMate, String goodsCertify, LocalDateTime goodsRd, LocalDateTime goodsMd, Double ratingAvg, String goodsMainImgPath, String goodsMainImgUuid, String goodsMainImgName) {
            super(goodsId, goodsName, goodsCategory, goodsQuantity, goodsPrice, goodsSaleCount, goodsDetailContent, goodsMate, goodsCertify, goodsRd, goodsMd);
            this.ratingAvg = ratingAvg;
            this.goodsMainImgPath = goodsMainImgPath;
            this.goodsMainImgUuid = goodsMainImgUuid;
            this.goodsMainImgName = goodsMainImgName;
        }

        public AdminGoodsDetail setGoodsDetailImg(List<AdminGoods.AdminGoodsDetailImg> adminGoodsDetailImg) {
            this.adminGoodsDetailImg = adminGoodsDetailImg;
            return this;
        }

    }


}

```
  
</details>
</details>

<br>

<details><summary>2. í˜ì´ì§• ì²˜ë¦¬ ê¸°ì¤€</summary>

```java

@Override
    public Page<AdminOrderListResultDto> orderList(Pageable pageable, AdminSearchOrderForm adminSearchOrderForm) {


        SearchForm searchForm = new SearchForm(adminSearchOrderForm.getCate(), adminSearchOrderForm.getKeyword());

        List<AdminOrderListDto> list = jpaQueryFactory.select(new QAdminOrderListDto(
                orderList.id,
                orders.id,
                orders.users.id,
                orders.users.userAccount,
                orders.orderUserAddressNumber,
                orders.orderAddressNormal,
                orders.orderAddressDetail,
                orders.orderUserEmail,
                orders.orderUserName,
                orders.orderUserPhoneNumber,
                orders.orderRegisterDate,
                goods.id,
                goods.goodsName,
                orderItem.orderPrice,
                orderItem.orderQuantity,
                orderList.orderDate
        ))
                .from(orderList)
                .leftJoin(orderList.orders, orders)
                .leftJoin(orders.users, users)
                .leftJoin(orders.orderItems, orderItem)
                .leftJoin(orderItem.goods, goods)
                .where(
                        cateKeywordEq(searchForm),
                        dateEq(adminSearchOrderForm.getPrev(), adminSearchOrderForm.getNext())

                )
                .limit(pageable.getPageSize())
                .offset(pageable.getOffset())
                .fetch();

        Long getTotal = jpaQueryFactory.select(
                orderList.count()
        )
                .from(orderList)
                .where(
                        cateKeywordEq(searchForm),
                        dateEq(adminSearchOrderForm.getPrev(), adminSearchOrderForm.getNext())

                )
                .fetchOne();


        return new PageImpl<>(convertOrderList(list),pageable, getTotal);


    }



    // AdminOrderListDto ëª©ë¡ì„ AdminOrderListResultDtoë¡œ ë³€í™˜í•˜ëŠ” ë©”ì„œë“œ
    private List<AdminOrderListResultDto> convertOrderList(List<AdminOrderListDto> orderList) {

       ....
    }


```

- í•œ í˜ì´ì§€ë‹¹ ë³´ì´ëŠ” ê²Œì‹œê¸€ì„ 15ê°œë¡œ ê³ ì •í•´ë†“ì•˜ë‹¤. í•˜ì§€ë§Œ ìœ„ ë°©ì‹ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ëŒë ¤ì„œ ë½‘ì•„ë³´ë‹ˆ <br>
  ì£¼ë¬¸ ëª©ë¡ id ê¸°ì¤€ìœ¼ë¡œ í˜ì´ì§•ì²˜ë¦¬ê°€ ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì£¼ë¬¸ ë‚´ì—­ì— ë“¤ì–´ê°€ ìˆëŠ” ìƒí’ˆë“¤ ìˆ˜ë¡œ í˜ì´ì§• ê¸°ì¤€ì´ ì¡í˜€ë²„ë ¸ë‹¤.
- ë”°ë¼ì„œ ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì£¼ë¬¸ID ì¡°íšŒë¥¼ ë£¨íŠ¸ë¡œ í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ë”°ë¡œ ë½‘ì•˜ê³  ê·¸ ê²°ê³¼ê°’ì„ ë³¸ ì¿¼ë¦¬ì˜ where inì ˆì— ì¡°ê±´ìœ¼ë¡œ ë„£ì—ˆë‹¤.

<details><summary>ìˆ˜ì • ì½”ë“œ
</summary>

```java

 @Override
    public Page<AdminOrderList.AdminOrdersListDto.AdminOrderListResultDto> orderLists(
            Pageable pageable, AdminSearchOrderForm adminSearchOrderForm) {

        SearchForm searchForm = new SearchForm(adminSearchOrderForm.getCate(), adminSearchOrderForm.getKeyword());

        //orderListIdë¡œ í˜ì´ì§•ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ë£¨íŠ¸ì¿¼ë¦¬
        List<Long> orderListIds = jpaQueryFactory
                .selectDistinct(orderList.id)
                .from(orderList)
                .where(
                        cateKeywordEq(searchForm),
                        dateEq(adminSearchOrderForm.getPrev(), adminSearchOrderForm.getNext())
                )

                .limit(pageable.getPageSize())
                .offset(pageable.getOffset())
                .fetch();

        System.out.println(orderListIds);

        List<AdminOrderList.AdminOrdersListDto> list = jpaQueryFactory.select(new QAdminOrderList_AdminOrdersListDto(
                orderList.id,
                orders.id,
                users.id,
                users.userAccount,
                orders.orderUserAddressNumber,
                orders.orderAddressNormal,
                orders.orderAddressDetails,
                orders.orderUserEmail,
                orders.orderUserName,
                orders.orderUserPhoneNumber,
                orders.orderRegisterDate,
                goods.id,
                goods.goodsName,
                orderItem.orderPrice,
                orderItem.orderQuantity,
                orders.orderRegisterDate
        ))
                .from(orderList)
                .leftJoin(orderList.orders, orders)
                .leftJoin(orders.users, users)
                .leftJoin(orders.orderItems, orderItem)
                .leftJoin(orderItem.goods, goods)
                .where(orderList.id.in(orderListIds))
                .fetch();

        Long getTotal = jpaQueryFactory.select(
                orderList.count()
        )
                .from(orderList)
                .where(
                        cateKeywordEq(searchForm),
                        dateEq(adminSearchOrderForm.getPrev(), adminSearchOrderForm.getNext())
                )
                .fetchOne();

        return new PageImpl<>(convertOrderList(list), pageable, getTotal);
    }

 private List<AdminOrderList.AdminOrdersListDto.AdminOrderListResultDto> convertOrderList(
            List<AdminOrderList.AdminOrdersListDto> orderList) {

...
}

```



</details>

</details>

<hr>

## ğŸ“ŒëŠë‚€ì 

ì •ì‹ìœ¼ë¡œ JPA ìˆ˜ì—…ë„ ë“¤ì—ˆë˜ ê²ƒì´ ì•„ë‹ˆê³  ì¸í”„ëŸ°ì—ì„œ JPA ê´€ë ¨ ê°•ì˜ ë‘ ê°œë¥¼ ë“¤ìœ¼ë©° ì‹œì‘í–ˆë˜ í”„ë¡œì íŠ¸ì˜€ë‹¤. ê·¸ ìƒíƒœë¡œ ì²˜ìŒ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í–ˆì„ ë•Œ, ë¹Œë” íŒ¨í„´ì—ì„œ ë§‰íˆê¸° ì‹œì‘í–ˆë‹¤. ê·¸ë˜ì„œ ë¹Œë” íŒ¨í„´ì€ ë¬´ì—‡ì´ê³  ë¹Œë” íŒ¨í„´ì€ ì™œ ì‚¬ìš©í•˜ëŠ”ì§€ ë“±ì„ ì´ëŸ° ì €ëŸ° ìë£Œë¥¼ ì°¾ì•„ë³´ë©° í”„ë¡œì íŠ¸ì— ì ìš©í•˜ê¸° ì‹œì‘í–ˆë‹¤.  

í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©° JPAì—ì„œ ê²½ê³„í•´ì•¼í•˜ëŠ” N+1 ë¬¸ì œê°€ ì¼ì–´ë‚œ ì ì´ í•œ ë²ˆ ìˆì—ˆë‹¤. ë³´í†µ N+1ì´ í„°ì§€ëŠ” ì´ìœ ëŠ” íŠ¹íˆ ForEach(ë¹ ë¥¸ forë¬¸) ì•ˆì—ì„œ ì¿¼ë¦¬ê°€ ê°œìˆ˜ë§Œí¼ ë” ëŒì•„ê°€ëŠ” ê²½ìš°ì˜€ê³ , ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì •ë³´ë¥¼ í•˜ë‚˜ì˜ ì¿¼ë¦¬ë¡œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê±°ë‚˜ ì—¬ëŸ¬ ì¿¼ë¦¬ë¡œ ì¡°íšŒí•˜ì—¬ ìŠ¤íŠ¸ë¦¼ì„ í†µí•´ ë§¤í•‘ì„ í•˜ì˜€ë‹¤. 

ê·¸ëŸ°ë° í•œ ê°€ì§€ ë¬¸ì œê°€ ìˆì—ˆëŠ”ë° ì—”í‹°í‹° ê´€ê³„ê°€ OneToOneì¸ ê²½ìš° ìë™ì ìœ¼ë¡œ ìœ ë‹ˆí¬ í‚¤ê°€ ì„¤ì •ë˜ì–´ ì‚­ì œ í›„ ìˆ˜ì • ë¡œì§ì´ ë“¤ì–´ê°€ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í–ˆì„ ì‹œ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤. ë•Œë¬¸ì— ì–´ì©” ìˆ˜ ì—†ì´ OneToOne ê´€ê³„ì§€ë§Œ OneToMany , ManyToOneìœ¼ë¡œ ê´€ê³„ë¥¼ ì„¤ì •í•´ì•¼ë§Œ í–ˆë‹¤.

ê¹Œë‹¤ë¡­ë‹¤ë©´ ê¹Œë‹¤ë¡œìš´ ì´ ORM ê¸°ìˆ ì„ í•œ ë²ˆ ì‚¬ìš©í•´ë³´ë‹ˆ ì¥ì ì€ ëª…í™•í–ˆë‹¤. ì¼ë‹¨ JAVAê°€ ì¼ì¢…ì˜ ì£¼ì¸ì´ ë˜ì–´ JAVA ì½”ë“œë¡œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ ê°€ì¥ í° ì¥ì ì´ ì•„ë‹ê¹Œ ì‹¶ë‹¤. 

