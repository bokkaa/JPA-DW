# SpringBoot-JPA-Project-ì‚°ì±…ê°ˆê°œ
ìŠ¤í”„ë§ë¶€íŠ¸ JPA í”„ë¡œì íŠ¸
<br>


## ğŸ–¥ï¸ í”„ë¡œì íŠ¸ ì†Œê°œ
ê°•ì•„ì§€ ì‚°ì±… ì†Œì…œë©”ì´íŠ¸, ì‡¼í•‘ í”Œë«í¼
<br>


## ğŸ•°ï¸ ê°œë°œ ê¸°ê°„
* 2023.11 - 2024.01

### ğŸ§‘â€ğŸ¤â€ğŸ§‘ ë§´ë²„êµ¬ì„±
 - íŒ€ì¥: ë…¸ì˜ì§„ : ì‡¼í•‘í˜ì´ì§€, ì¥ë°”êµ¬ë‹ˆ, ì£¼ë¬¸ì„œ ë° ê²°ì œ í˜ì´ì§€, ììœ ê²Œì‹œíŒ, ê³µì§€ì‚¬í•­ ê²Œì‹œíŒ
 - íŒ€ì›1: ë³µì˜í—Œ : ë©”ì¸í˜ì´ì§€(ì‚°ì±…ê¸€ ëª©ë¡, ì£¼ê°„ì¸ê¸°ê¸€, ì‡¼í•‘ ë“±), ë¡œê·¸ì¸ ë° íšŒì›ê°€ì… ë“± ê³„ì •ê´€ë¦¬ í˜ì´ì§€, ì‚°ì±… ë©”ì´íŠ¸ ê²Œì‹œíŒ, ê´€ë¦¬ìí˜ì´ì§€
 - íŒ€ì›2: ì„í˜•ì¤€ : ë§ˆì´í˜ì´ì§€, QnAê²Œì‹œíŒ


### âš™ï¸ ê°œë°œ í™˜ê²½
- **IDE** : IntelliJ IDEA
- **Framework** : Springboot(3.x)
- **Database** : Oracle DB(11xe)
- **ORM** : JPA

### í¬íŠ¸í´ë¦¬ì˜¤ 

[í¬í´1ì°¨.pdf](https://github.com/bokkaa/JPA-DW/files/14395778/1.pdf)

## ğŸ“Œ ë‚´ê°€ ë§¡ì€ ê¸°ëŠ¥
#### ë©”ì¸ í˜ì´ì§€ <a href="https://github.com/bokkaa/JPA-DW/wiki/%EB%A9%94%EC%9D%B8%ED%8E%98%EC%9D%B4%EC%A7%80" >ìƒì„¸ë³´ê¸° - WIKI ì´ë™</a>
- ì‚°ì±…ë©”ì´íŠ¸ ìµœì‹  ë¦¬ìŠ¤íŠ¸
- ì£¼ê°„ ì¸ê¸° QnA ê²Œì‹œê¸€/ ììœ ê²Œì‹œíŒ ê¸€
- ì¹´í…Œê³ ë¦¬ë³„ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸
- ìµœê·¼ ë³¸ ìƒí’ˆ

#### ë¡œê·¸ì¸ / íšŒì›ê°€ì… / ê³„ì •ì°¾ê¸° <a href="https://github.com/bokkaa/JPA-DW/wiki/%EA%B3%84%EC%A0%95-%EA%B4%80%EB%A0%A8" >ìƒì„¸ë³´ê¸° - WIKI ì´ë™</a>
- ë¡œê·¸ì¸
- íšŒì›ê°€ì…
- ê³„ì •ì°¾ê¸°

#### ì‚°ì±…ê²Œì‹œê¸€ í˜ì´ì§€ <a href="https://github.com/bokkaa/JPA-DW/wiki/%EC%82%B0%EC%B1%85%EB%A9%94%EC%9D%B4%ED%8A%B8-%EA%B2%8C%EC%8B%9C%ED%8C%90" >ìƒì„¸ë³´ê¸° - WIKI ì´ë™</a>
- ì‚°ì±…ê²Œì‹œê¸€ ëª©ë¡
- ì‚°ì±…ê²Œì‹œê¸€ ìƒì„¸
- ì‚°ì±…ê²Œì‹œê¸€ ë“±ë¡
- ì‚°ì±…ê²Œì‹œê¸€ ìˆ˜ì • ë° ì‚­ì œ
  
#### ê´€ë¦¬ì í˜ì´ì§€ <a href="https://github.com/dafssdf/Spring_Portfoilo/wiki/%EB%A7%88%EC%9D%B4-%ED%8E%98%EC%9D%B4%EC%A7%80" >ìƒì„¸ë³´ê¸° - WIKI ì´ë™</a>
- íšŒì›ê´€ë¦¬
- ìƒí’ˆê´€ë¦¬
- ì£¼ë¬¸ê´€ë¦¬
- ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬

<hr>

## ì½”ë“œ ìˆ˜ì • 

<details><summary>1. ë¬´í•œ ì¦ì‹ DTO</summary>

<img width="467" alt="ì œëª© ì—†ìŒ" src="https://github.com/bokkaa/JPA-DW/assets/77730779/8ebbaafe-7333-4178-8bde-49104b332e1c">

- ì¡°íšŒ ì •ë³´ ë¡œì§ì„ ì£¼ë¡œ ë‹´ë‹¹í•˜ëŠ” ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì¡°íšŒìš© DTOë¥¼ ë§ˆêµ¬ì¡ì´ë¡œ ë§Œë“¤ë‹¤ë³´ë‹ˆ .java íŒŒì¼ ìì²´ê°€ ë„ˆë¬´ ë§ì•„ì¡Œë‹¤.
- ê·¸ë˜ì„œ ì´ê±¸ ì–´ë–»ê²Œ í•˜ë©´ ê°€ë…ì„±ë„ ì¢‹ê³  ìœ ì§€ë³´ìˆ˜ë¥¼ ì‰½ê²Œ í•  ìˆ˜ ìˆì„ê¹Œ í•´ì„œ ìƒê°í•´ë‚¸ ê²ƒì´ ë‚´ë¶€ í´ë˜ìŠ¤ì˜ í™œìš©ì´ì—ˆë‹¤.
- ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ í™œìš©í•˜ë‹ˆ ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ìƒí’ˆ ê´€ë ¨ DTOë¥¼ ì•½ 12ê°œì—ì„œ 4ê°œë¡œ ì¤„ì¼ ìˆ˜ ìˆì—ˆë‹¤.


<img width="352" alt="ì œëª© ì—†ìŒ1" src="https://github.com/bokkaa/JPA-DW/assets/77730779/43337bab-5c48-4db5-aab0-2af78ef683af">

<details><summary>Goods/AdminGoods.java </summary>
 
```java
package com.example.dw.domain.dto.admin.goods;

import com.querydsl.core.annotations.QueryProjection;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;
import java.util.List;

@Data
@NoArgsConstructor
public class AdminGoods extends AdminGoodsStan {


    private Long goodsMainImgId;
    private String goodsMainImgPath;
    private String goodsMainImgUuid;
    private String goodsMainImgName;

    private Long goodsDetailImgId;
    private String goodsDetailImgPath;
    private String goodsDetailImgUuid;
    private String goodsDetailImgName;


    @QueryProjection
    public AdminGoods(Long goodsId, String goodsName, String goodsCategory, Integer goodsQuantity, Integer goodsPrice, Integer goodsSaleCount, String goodsDetailContent, String goodsMate, String goodsCertify, LocalDateTime goodsRd, LocalDateTime goodsMd, Long goodsMainImgId, String goodsMainImgPath, String goodsMainImgUuid, String goodsMainImgName, Long goodsDetailImgId, String goodsDetailImgPath, String goodsDetailImgUuid, String goodsDetailImgName) {
        super(goodsId, goodsName, goodsCategory, goodsQuantity, goodsPrice, goodsSaleCount, goodsDetailContent, goodsMate, goodsCertify, goodsRd, goodsMd);
        this.goodsMainImgId = goodsMainImgId;
        this.goodsMainImgPath = goodsMainImgPath;
        this.goodsMainImgUuid = goodsMainImgUuid;
        this.goodsMainImgName = goodsMainImgName;
        this.goodsDetailImgId = goodsDetailImgId;
        this.goodsDetailImgPath = goodsDetailImgPath;
        this.goodsDetailImgUuid = goodsDetailImgUuid;
        this.goodsDetailImgName = goodsDetailImgName;
    }




    //ì œí’ˆ ë©”ì¸ ì‚¬ì§„
    @Data
    @NoArgsConstructor
    public static class AdminGoodsMainImg {

        private Long goodsMainImgId;
        private String goodsMainImgPath;
        private String goodsMainImgUuid;
        private String goodsMainImgName;


        public AdminGoodsMainImg(Long goodsMainImgId, String goodsMainImgPath, String goodsMainImgUuid, String goodsMainImgName) {
            this.goodsMainImgId = goodsMainImgId;
            this.goodsMainImgPath = goodsMainImgPath;
            this.goodsMainImgUuid = goodsMainImgUuid;
            this.goodsMainImgName = goodsMainImgName;
        }
    }

    //ì œí’ˆ ìƒì„¸ ì‚¬ì§„
    @Data
    public static class AdminGoodsDetailImg {
        private Long goodsDetailImgId;
        private String goodsDetailImgPath;
        private String goodsDetailImgUuid;
        private String goodsDetailImgName;


        public AdminGoodsDetailImg(Long goodsDetailImgId, String goodsDetailImgPath, String goodsDetailImgUuid, String goodsDetailImgName) {
            this.goodsDetailImgId = goodsDetailImgId;
            this.goodsDetailImgPath = goodsDetailImgPath;
            this.goodsDetailImgUuid = goodsDetailImgUuid;
            this.goodsDetailImgName = goodsDetailImgName;
        }
    }


    //ê´€ë¦¬ì í˜ì´ì§€ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸
    @Data
    public static class AdminGoodsList {

        private Long goodsId;
        private String goodsCategory;
        private String goodsName;
        private Integer goodsQuantity;
        private Integer goodsSaleCount;
        private Integer goodsPrice;

        private LocalDateTime goodsRd;
        private LocalDateTime goodsMd;

        @QueryProjection
        public AdminGoodsList(Long goodsId, String goodsCategory, String goodsName, Integer goodsQuantity, Integer goodsSaleCount, Integer goodsPrice, LocalDateTime goodsRd, LocalDateTime goodsMd) {
            this.goodsId = goodsId;
            this.goodsCategory = goodsCategory;
            this.goodsName = goodsName;
            this.goodsQuantity = goodsQuantity;
            this.goodsSaleCount = goodsSaleCount;
            this.goodsPrice = goodsPrice;
            this.goodsRd = goodsRd;
            this.goodsMd = goodsMd;
        }
    }


    //ê´€ë¦¬ì í˜ì´ì§€ ìƒí’ˆ ìƒì„¸ë³´ê¸°
    @Data
    public static class AdminGoodsDetail extends AdminGoodsStan {

        private Double ratingAvg;

        private String goodsMainImgPath;
        private String goodsMainImgUuid;
        private String goodsMainImgName;
        private List<AdminGoods.AdminGoodsDetailImg> adminGoodsDetailImg;

        public AdminGoodsDetail(Long goodsId, String goodsName, String goodsCategory, Integer goodsQuantity, Integer goodsPrice, Integer goodsSaleCount, String goodsDetailContent, String goodsMate, String goodsCertify, LocalDateTime goodsRd, LocalDateTime goodsMd, Double ratingAvg, String goodsMainImgPath, String goodsMainImgUuid, String goodsMainImgName) {
            super(goodsId, goodsName, goodsCategory, goodsQuantity, goodsPrice, goodsSaleCount, goodsDetailContent, goodsMate, goodsCertify, goodsRd, goodsMd);
            this.ratingAvg = ratingAvg;
            this.goodsMainImgPath = goodsMainImgPath;
            this.goodsMainImgUuid = goodsMainImgUuid;
            this.goodsMainImgName = goodsMainImgName;
        }

        public AdminGoodsDetail setGoodsDetailImg(List<AdminGoods.AdminGoodsDetailImg> adminGoodsDetailImg) {
            this.adminGoodsDetailImg = adminGoodsDetailImg;
            return this;
        }

    }


}

```
  
</details>
</details>

<details><summary>2. í˜ì´ì§• ì²˜ë¦¬ ê¸°ì¤€</summary>

```java

@Override
    public Page<AdminOrderListResultDto> orderList(Pageable pageable, AdminSearchOrderForm adminSearchOrderForm) {


        SearchForm searchForm = new SearchForm(adminSearchOrderForm.getCate(), adminSearchOrderForm.getKeyword());

        List<AdminOrderListDto> list = jpaQueryFactory.select(new QAdminOrderListDto(
                orderList.id,
                orders.id,
                orders.users.id,
                orders.users.userAccount,
                orders.orderUserAddressNumber,
                orders.orderAddressNormal,
                orders.orderAddressDetail,
                orders.orderUserEmail,
                orders.orderUserName,
                orders.orderUserPhoneNumber,
                orders.orderRegisterDate,
                goods.id,
                goods.goodsName,
                orderItem.orderPrice,
                orderItem.orderQuantity,
                orderList.orderDate
        ))
                .from(orderList)
                .leftJoin(orderList.orders, orders)
                .leftJoin(orders.users, users)
                .leftJoin(orders.orderItems, orderItem)
                .leftJoin(orderItem.goods, goods)
                .where(
                        cateKeywordEq(searchForm),
                        dateEq(adminSearchOrderForm.getPrev(), adminSearchOrderForm.getNext())

                )
                .limit(pageable.getPageSize())
                .offset(pageable.getOffset())
                .fetch();

        Long getTotal = jpaQueryFactory.select(
                orderList.count()
        )
                .from(orderList)
                .where(
                        cateKeywordEq(searchForm),
                        dateEq(adminSearchOrderForm.getPrev(), adminSearchOrderForm.getNext())

                )
                .fetchOne();


        return new PageImpl<>(convertOrderList(list),pageable, getTotal);


    }



    // AdminOrderListDto ëª©ë¡ì„ AdminOrderListResultDtoë¡œ ë³€í™˜í•˜ëŠ” ë©”ì„œë“œ
    private List<AdminOrderListResultDto> convertOrderList(List<AdminOrderListDto> orderList) {

        //.collect stream()ì„ ìë£Œêµ¬ì¡°ë¡œ ë‹´ì„ë–„ ì‚¬ìš©
        Map<Long, List<AdminOrderListDto>> groupedOrders = orderList.stream()
                .collect(Collectors.groupingBy(AdminOrderListDto::getOrderListId));
        //orderListIdë¡œ ê·¸ë£¹í™”í•œë‹¤. ì¦‰ Mapì˜ Keyê°’ì´ orderListIdë¡œ ë“¤ì–´ê°€ê²Œë˜ë©°
        //valueê°’ì€ List<>ëª¨ë“  ê°’ë“¤ì´ ì°¨ë¡€ëŒ€ë¡œ ë“¤ì–´ê°„ë‹¤.


                            //ë§µì„ ëœ¯ìŒ                     //í‚¤ê°’ ê¸°ì¤€ìœ¼ë¡œ ì—­ìˆœ(ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬)
        return groupedOrders.entrySet().stream().sorted(Map.Entry.comparingByKey(Comparator.reverseOrder()))
                .map(entry -> {
                    Long orderListId = entry.getKey(); //Mapì˜ keyê°’
                    LocalDateTime payDatetime = entry.getValue().stream().findFirst()
                            .map(AdminOrderListDto::getOrderDate)
                            .orElse(null); //findFirst()ì‚¬ìš© ì‹œ ì˜ˆì™¸ì²˜ë¦¬ë‚˜ nullì²˜ë¦¬ í•„ìˆ˜
                    List<AdminOrderListDto> orderListDtos = entry.getValue(); //Mapì˜ valueê°’


                    List<AdminOrderItem> adminOrderItems = orderListDtos.stream()
                            .map(dto -> new AdminOrderItem(
                                    dto.getGoodsId(),
                                    dto.getGoodsName(),
                                    dto.getGoodsPrice(),
                                    dto.getGoodsQuantity()
                            ))
                            .collect(Collectors.toList());



                    AdminOrderInfo adminOrderInfo = orderListDtos.stream()
                            .findFirst() // ì¤‘ë³µë˜ëŠ” ì£¼ë¬¸ì ì •ë³´ê°€ ë™ì¼í•˜ë‹¤ë©´ ì²« ë²ˆì§¸ ì •ë³´ë§Œ ê°€ì ¸ì˜´
                            .map(dto -> new AdminOrderInfo(
                                    dto.getOrderId(),
                                    dto.getUserId(),
                                    dto.getUserAccount(),
                                    dto.getOrderZipcode(),
                                    dto.getOrderAddress(),
                                    dto.getOrderDetailAddress(),
                                    dto.getOrderUserEmail(),
                                    dto.getOrderUserName(),
                                    dto.getOrderUserPhone(),
                                    dto.getOrderDate(),
                                    adminOrderItems // ì£¼ë¬¸ ëª©ë¡ì„ AdminOrderInfo ì•ˆì— í¬í•¨
                            ))
                            .orElse(null);

                    return new AdminOrderListResultDto(orderListId,payDatetime,adminOrderInfo);
                })
                .collect(Collectors.toList()); //ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜(Mapì—ì„œ keyê°’ì„ ë²„ë¦¬ê³  valueê°’ìœ¼ë¡œ ë¦¬ìŠ¤íŠ¸ë¡œ ë§Œë“ ë‹¤.)
    }

private List<AdminOrderList.AdminOrdersListDto.AdminOrderListResultDto> convertOrderList(
            List<AdminOrderList.AdminOrdersListDto> orderList) {


        Map<Long, List<AdminOrderList.AdminOrdersListDto>> groupedOrders =
                orderList.stream()
                .collect(groupingBy(AdminOrderList.AdminOrdersListDto::getOrderListId));



        return groupedOrders.entrySet().stream().sorted(Map.Entry.comparingByKey(Comparator.reverseOrder()))
                .map(entry -> {

                    Long orderListId = entry.getKey();

                    LocalDateTime payDatetime = entry.getValue().stream().findFirst()
                            .map(AdminOrderList.AdminOrdersListDto::getOrderDate)
                            .orElse(null);

                    List<AdminOrderList.AdminOrdersListDto> orderListDtos = entry.getValue();

                    //ì£¼ë¬¸ë‹¹ êµ¬ë§¤í•œ ìƒí’ˆì€ ì—¬ëŸ¬ ê°œì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ êµ¬ë§¤ ìƒí’ˆë§Œ Listì— ë‹´ì•„ì¤€ë‹¤.
                    List<AdminOrderList.AdminOrdersListDto.AdminOrderItem> adminOrderItems = orderListDtos.stream()
                            .map(dto -> new AdminOrderList.AdminOrdersListDto.AdminOrderItem(
                                    dto.getGoodsId(),
                                    dto.getGoodsName(),
                                    dto.getGoodsPrice(),
                                    dto.getGoodsQuantity()
                            ))
                            .collect(Collectors.toList());

                    AdminOrderList.AdminOrdersListDto.AdminOrderInfo adminOrderInfo = orderListDtos.stream()
                            .findFirst() //ì¤‘ë³µ ì¡°íšŒëœ ê°’ì€ í•˜ë‚˜ë¡œ ì²˜ë¦¬í•œë‹¤.
                            .map(dto -> new AdminOrderList.AdminOrdersListDto.AdminOrderInfo(
                                    dto.getOrderId(),
                                    dto.getUserId(),
                                    dto.getUserAccount(),
                                    dto.getOrderZipcode(),
                                    dto.getOrderAddress(),
                                    dto.getOrderDetailAddress(),
                                    dto.getOrderUserEmail(),
                                    dto.getOrderUserName(),
                                    dto.getOrderUserPhone(),
                                    dto.getOrderDate(),
                                    adminOrderItems //ì£¼ë¬¸í•œ ìƒí’ˆë¦¬ìŠ¤íŠ¸
                            ))
                            .orElse(null);

                    return new AdminOrderList.AdminOrdersListDto.AdminOrderListResultDto(orderListId,payDatetime,adminOrderInfo);
                })
                .collect(Collectors.toList());
    }


```

- í˜ì´ì§• ì²˜ë¦¬ ë³€ìˆ˜ë¥¼ 15ë¡œ ê³ ì •í•´ë†“ì•˜ë‹¤. í•˜ì§€ë§Œ ìœ„ ë°©ì‹ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ëŒë ¤ì„œ ë½‘ì•„ë³´ë‹ˆ
  ì£¼ë¬¸ ëª©ë¡ id ê¸°ì¤€ìœ¼ë¡œ í˜ì´ì§•ì²˜ë¦¬ê°€ ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì£¼ë¬¸ ë‚´ì—­ë° ë“¤ì–´ê°€ ìˆëŠ” ìƒí’ˆë“¤ ìˆ˜ë¡œ í˜ì´ì§• ê¸°ì¤€ì´ ì¡í˜€ë²„ë ¸ë‹¤.
- ë”°ë¼ì„œ ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì£¼ë¬¸ID ì¡°íšŒë¥¼ ë£¨íŠ¸ë¡œ í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ë”°ë¡œ ë½‘ì•˜ê³  ê·¸ ê²°ê³¼ê°’ì„ ë³¸ ì¿¼ë¦¬ì˜ where inì ˆì— ì¡°ê±´ìœ¼ë¡œ ë„£ì—ˆë‹¤.

<details><summary>ìˆ˜ì • ì½”ë“œ
</summary>

```java

 @Override
    public Page<AdminOrderList.AdminOrdersListDto.AdminOrderListResultDto> orderLists(
            Pageable pageable, AdminSearchOrderForm adminSearchOrderForm) {

        SearchForm searchForm = new SearchForm(adminSearchOrderForm.getCate(), adminSearchOrderForm.getKeyword());

        //orderListIdë¡œ í˜ì´ì§•ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ë£¨íŠ¸ì¿¼ë¦¬
        List<Long> orderListIds = jpaQueryFactory
                .selectDistinct(orderList.id)
                .from(orderList)
                .where(
                        cateKeywordEq(searchForm),
                        dateEq(adminSearchOrderForm.getPrev(), adminSearchOrderForm.getNext())
                )

                .limit(pageable.getPageSize())
                .offset(pageable.getOffset())
                .fetch();

        System.out.println(orderListIds);

        List<AdminOrderList.AdminOrdersListDto> list = jpaQueryFactory.select(new QAdminOrderList_AdminOrdersListDto(
                orderList.id,
                orders.id,
                users.id,
                users.userAccount,
                orders.orderUserAddressNumber,
                orders.orderAddressNormal,
                orders.orderAddressDetails,
                orders.orderUserEmail,
                orders.orderUserName,
                orders.orderUserPhoneNumber,
                orders.orderRegisterDate,
                goods.id,
                goods.goodsName,
                orderItem.orderPrice,
                orderItem.orderQuantity,
                orders.orderRegisterDate
        ))
                .from(orderList)
                .leftJoin(orderList.orders, orders)
                .leftJoin(orders.users, users)
                .leftJoin(orders.orderItems, orderItem)
                .leftJoin(orderItem.goods, goods)
                .where(orderList.id.in(orderListIds))
                .fetch();

        Long getTotal = jpaQueryFactory.select(
                orderList.count()
        )
                .from(orderList)
                .where(
                        cateKeywordEq(searchForm),
                        dateEq(adminSearchOrderForm.getPrev(), adminSearchOrderForm.getNext())
                )
                .fetchOne();

        return new PageImpl<>(convertOrderList(list), pageable, getTotal);
    }

```



</details>

</details>
